(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2501],{760:(e,t,a)=>{"use strict";a.d(t,{N:()=>b});var s=a(5155),r=a(2115),n=a(869),l=a(2885),o=a(7494),i=a(845),c=a(7351),d=a(1508);class u extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,a=(0,c.s)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=a-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function p(e){let{children:t,isPresent:a,anchorX:n,root:l}=e,o=(0,r.useId)(),i=(0,r.useRef)(null),c=(0,r.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=(0,r.useContext)(d.Q);return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:r,right:d}=c.current;if(a||!i.current||!e||!t)return;i.current.dataset.motionPopId=o;let u=document.createElement("style");p&&(u.nonce=p);let m=null!=l?l:document.head;return m.appendChild(u),u.sheet&&u.sheet.insertRule('\n          [data-motion-pop-id="'.concat(o,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===n?"left: ".concat(r):"right: ".concat(d),"px !important;\n            top: ").concat(s,"px !important;\n          }\n        ")),()=>{m.contains(u)&&m.removeChild(u)}},[a]),(0,s.jsx)(u,{isPresent:a,childRef:i,sizeRef:c,children:r.cloneElement(t,{ref:i})})}let m=e=>{let{children:t,initial:a,isPresent:n,onExitComplete:o,custom:c,presenceAffectsLayout:d,mode:u,anchorX:m,root:f}=e,x=(0,l.M)(h),g=(0,r.useId)(),b=!0,w=(0,r.useMemo)(()=>(b=!1,{id:g,initial:a,isPresent:n,custom:c,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;o&&o()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[n,x,o]);return d&&b&&(w={...w}),(0,r.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[n]),r.useEffect(()=>{n||x.size||!o||o()},[n]),"popLayout"===u&&(t=(0,s.jsx)(p,{isPresent:n,anchorX:m,root:f,children:t})),(0,s.jsx)(i.t.Provider,{value:w,children:t})};function h(){return new Map}var f=a(2082);let x=e=>e.key||"";function g(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}let b=e=>{let{children:t,custom:a,initial:i=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:u="sync",propagate:p=!1,anchorX:h="left",root:b}=e,[w,y]=(0,f.xQ)(p),v=(0,r.useMemo)(()=>g(t),[t]),j=p&&!w?[]:v.map(x),N=(0,r.useRef)(!0),S=(0,r.useRef)(v),_=(0,l.M)(()=>new Map),[k,I]=(0,r.useState)(v),[E,P]=(0,r.useState)(v);(0,o.E)(()=>{N.current=!1,S.current=v;for(let e=0;e<E.length;e++){let t=x(E[e]);j.includes(t)?_.delete(t):!0!==_.get(t)&&_.set(t,!1)}},[E,j.length,j.join("-")]);let B=[];if(v!==k){let e=[...v];for(let t=0;t<E.length;t++){let a=E[t],s=x(a);j.includes(s)||(e.splice(t,0,a),B.push(a))}return"wait"===u&&B.length&&(e=B),P(g(e)),I(v),null}let{forceRender:C}=(0,r.useContext)(n.L);return(0,s.jsx)(s.Fragment,{children:E.map(e=>{let t=x(e),r=(!p||!!w)&&(v===E||j.includes(t));return(0,s.jsx)(m,{isPresent:r,initial:(!N.current||!!i)&&void 0,custom:a,presenceAffectsLayout:d,mode:u,root:b,onExitComplete:r?void 0:()=>{if(!_.has(t))return;_.set(t,!0);let e=!0;_.forEach(t=>{t||(e=!1)}),e&&(null==C||C(),P(S.current),p&&(null==y||y()),c&&c())},anchorX:h,children:e},t)})})}},1179:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(5155),r=a(2115),n=a(9053),l=a(9911),o=a(5695),i=a(6766),c=a(760),d=a(8274);function u(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(p,{})})}function p(){let[e,t]=(0,r.useState)(""),[a,u]=(0,r.useState)(""),[p,m]=(0,r.useState)(""),[h,f]=(0,r.useState)({companyName:"",companyLogo:""}),[x,g]=(0,r.useState)(""),b=(0,o.useSearchParams)(),w=null==b?void 0:b.get("proposalId"),y="https://zydev.pythonanywhere.com",[v,j]=(0,r.useState)([]),N=async()=>{if(w)try{let e=sessionStorage.getItem("access_token");if(!e)return;let t=await fetch("".concat(y,"/api/document/get_proposal_files/").concat(w),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)return void j([]);let a=await t.json(),s=(sessionStorage.getItem("role"),a.map(e=>{let t=e.is_bpi?"bpi":"user";return{id:e.id.toString(),date:new Date(e.created_at).toISOString().split("T")[0],time:new Date(e.created_at).toLocaleTimeString("en-PH",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Manila"}),title:e.name,description:e.description,status:"completed",sender:t,fileType:e.type,fileSize:"",downloadUrl:"".concat(y,"/api/document/download_file/").concat(e.id),viewUrl:e.view_url}}));j(s)}catch(e){console.error("Failed to fetch timeline:",e)}};(0,r.useEffect)(()=>{w&&(console.log("Fetching proposal for ID:",w),(async()=>{try{let e,a,s=sessionStorage.getItem("access_token"),r=sessionStorage.getItem("role");if(!s||!r)return void console.error("Missing token or role in sessionStorage");if(!w)return void console.error("Missing proposalId in URL params");let n=await fetch("".concat(y,"/api/proposal/").concat(w),{headers:{Authorization:"Bearer ".concat(s)}});if(!n.ok)throw Error("Failed to fetch proposal");let l=await n.json();if("employee"===r)a={name:(e=l).company_name||"Unknown",logo:null};else{e=l;let t=await fetch("".concat(y,"/api/company?proposalId=").concat(e.company_id),{headers:{Authorization:"Bearer ".concat(s)}});if(!t.ok)throw Error("Failed to fetch company");a=await t.json()}t(e.title),u(e.collab_type),m(e.description),f({companyName:a.name,companyLogo:a.logo?"".concat(a.logo):"/logo/synsei_icon.png"});let o=await fetch("".concat(y,"/api/document/get_proposal_files/").concat(w),{headers:{Authorization:"Bearer ".concat(s)}});if(!o.ok){console.warn("No documents found for this proposal"),j([]);return}let i=(await o.json()).map(e=>{let t;return t=e.is_bpi?"bpi":"user",{id:e.id.toString(),date:new Date(e.created_at).toISOString().split("T")[0],time:new Date(e.created_at).toLocaleTimeString("en-PH",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Manila"}),title:e.name,description:e.description,status:"completed",sender:t,fileType:e.type,fileSize:"",downloadUrl:"".concat(y,"/api/document/download_file/").concat(e.id),viewUrl:e.view_url}});j(i)}catch(e){console.error("Error fetching proposal/company/files:",e)}})())},[w]);let[S,_]=(0,r.useState)(!1),[k,I]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),B=async e=>{if(e.preventDefault(),!C)return void alert("Please select a file to upload.");try{let e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("role");if(!e)return void alert("You are not authenticated.");if(!w)return void alert("Missing proposal ID.");let a=new FormData;a.append("file",C),a.append("name",k||C.name),a.append("description",E||""),a.append("type","Proposal"),a.append("proposal_id",w),a.append("is_bpi","employee"===t?"true":"false");let s=await fetch("".concat(y,"/api/document/upload_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:a});if(!s.ok){let e=await s.json();alert(e.error||"File upload failed.");return}let r=await s.json();console.log("Uploaded file:",r),j(e=>{var a,s,n;return[...e,{id:(null==(a=r.id)?void 0:a.toString())||Math.random().toString(36).substring(2),date:(null==(s=r.created_at)?void 0:s.split("T")[0])||new Date().toISOString().split("T")[0],time:r.created_at?new Date(r.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),title:r.name||C.name,description:r.description||"",status:"completed",sender:"employee"===t?"bpi":"user",fileType:r.type||(null==(n=C.name.split(".").pop())?void 0:n.toUpperCase()),fileSize:C.size?"".concat((C.size/1024/1024).toFixed(2)," MB"):void 0,fileUrl:r.file||"",downloadUrl:"".concat(y,"/api/document/download_file/").concat(r.id)}]}),D(null),I(""),P(""),_(!1),await N()}catch(e){console.error("Error uploading file:",e),alert("File upload failed. Check console for details.")}},[C,D]=(0,r.useState)(null),F=(0,r.useRef)(null),L=(0,o.useRouter)(),U=e=>{let{sender:t}=e;return"user"===t?(0,s.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200",children:(0,s.jsx)(i.default,{src:h.companyLogo&&""!==h.companyLogo.trim()?h.companyLogo:"/logo/synsei_icon.png",alt:h.companyName,width:40,height:40,className:"w-full h-full object-cover"})}):(0,s.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-white",children:(0,s.jsx)(i.default,{src:"/logo/bpi-logo.jpg",alt:"BPI",width:40,height:40,className:"w-full h-full object-cover"})})};return(0,s.jsx)(n.A,{allowedRoles:["user","employee"],children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(c.N,{mode:"wait",children:(0,s.jsxs)(d.P.div,{variants:{initial:{opacity:0,y:30},animate:{opacity:1,y:0,transition:{duration:.5,ease:[.25,.1,.25,1]}},exit:{opacity:0,y:-30,transition:{duration:.4,ease:[.25,.1,.25,1]}}},initial:"initial",animate:"animate",exit:"exit",className:"min-h-screen bg-gray-50 flex flex-col items-center px-4 sm:px-[5%] lg:px-[10%] py-4 sm:py-8",children:[(0,s.jsxs)("div",{className:"relative flex items-center w-full mt-2 mb-4",children:[(0,s.jsxs)("button",{onClick:()=>{"employee"===sessionStorage.getItem("role")?L.push("/bpidashboard"):L.push("/dashboard")},className:"absolute left-0 flex items-center text-[#B11016] hover:text-[#800b10] text-sm sm:text-base",children:[(0,s.jsx)(l.QVr,{className:"mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Back"})]}),(0,s.jsxs)("div",{className:"text-center w-full",children:[(0,s.jsx)("h1",{className:"text-xl sm:text-2xl lg:text-4xl font-bold text-[#B11016] pb-2 sm:pb-4",children:"Track Your Files"}),(0,s.jsx)("p",{className:"text-sm sm:text-md text-black mb-4 sm:mb-6 px-4",children:"View the files you submitted and exchanged with BPI."}),(0,s.jsx)("div",{className:"mx-2 border-b-[3px] border-[#B11016]"})]})]}),(0,s.jsxs)("div",{className:"w-full max-w-4xl mt-4",children:[(0,s.jsx)("div",{className:"text-center mb-6 sm:mb-8",children:(0,s.jsx)("h2",{className:"text-base sm:text-lg lg:text-xl font-bold text-[#B11016]",children:"FILE EXCHANGE"})}),(0,s.jsxs)("div",{className:"space-y-4 pb-6 px-2 sm:px-0",children:[v.map(e=>{let t=sessionStorage.getItem("role"),a="user"===e.sender&&"user"===t||"bpi"===e.sender&&"employee"===t;return(0,s.jsxs)("div",{className:"flex items-end ".concat(a?"justify-end":"justify-start"),children:[!a&&(0,s.jsx)("div",{className:"mr-4 shadow-lg rounded-full overflow-hidden",children:(0,s.jsx)(U,{sender:e.sender})}),(0,s.jsxs)("div",{className:"w-100 max-w-[calc(100vw-80px)] sm:max-w-md shadow-lg ".concat(a?"bg-[#B11016] text-white":"bg-[#fdfdfd]"," rounded-lg p-4 relative"),children:[(0,s.jsx)("div",{className:"text-xs font-semibold mb-2 pb-2 border-b-1 ".concat(a?"text-white opacity-90 border-white":"text-[#B11016] border-[#B11016]"),children:"user"===e.sender?h.companyName.toUpperCase():"BPI | ".concat(x).toUpperCase()}),(0,s.jsx)("div",{className:"flex items-start space-x-3",children:(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"font-semibold text-md mb-1 ".concat(a?"text-white":"text-gray-800"),children:e.title}),(0,s.jsx)("p",{className:"text-sm mb-2 line-clamp-2 ".concat(a?"text-white":"text-gray-600"),children:e.description}),(0,s.jsxs)("div",{className:"text-xs mt-1 mb-2 ".concat(a?"text-white opacity-75":"text-gray-400"),children:[new Date(e.date).toLocaleDateString("en-PH",{month:"short",day:"numeric",year:"numeric"})," at ",e.time]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs ".concat(a?"text-white opacity-75":"text-gray-500"),children:[(0,s.jsxs)("span",{className:"truncate",children:[e.fileType," • ",e.fileSize]}),(0,s.jsx)("button",{onClick:()=>window.open(e.downloadUrl,"_blank"),className:"p-1 rounded hover:bg-opacity-20 hover:bg-gray-500 transition-colors flex-shrink-0 ml-2 ".concat(a?"text-white":"text-[#B11016]"),children:(0,s.jsx)(l.WCW,{size:12})})]})]})}),(0,s.jsx)("div",{className:"absolute bottom-4 ".concat(a?"-right-2 border-l-8 border-l-[#B11016] border-t-4 border-b-4 border-t-transparent border-b-transparent shadow-md":"-left-2 border-r-8 border-r-white border-t-4 border-b-4 border-t-transparent border-b-transparent shadow-md"," w-0 h-0")})]}),a&&(0,s.jsx)("div",{className:"ml-4 shadow-lg rounded-full overflow-hidden",children:(0,s.jsx)(U,{sender:e.sender})})]},e.id)}),0===v.length&&(0,s.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,s.jsx)(l.t69,{className:"mx-auto text-4xl mb-4 opacity-30"}),(0,s.jsx)("p",{className:"text-sm sm:text-base",children:"No files exchanged yet"}),(0,s.jsx)("p",{className:"text-xs sm:text-sm mt-1 px-4",children:"Files will appear here as they are shared between you and BPI"})]})]}),v.length>0&&(0,s.jsx)("div",{className:"text-center mt-8",children:(0,s.jsx)("span",{className:"text-xs text-gray-400 bg-gray-50 px-3 py-1 rounded-full",children:"End of conversation"})})]}),(0,s.jsx)("div",{className:"w-full max-w-4xl mt-6 sm:mt-10 px-2 sm:px-0",children:(0,s.jsx)("button",{onClick:()=>_(!0),className:"w-full bg-[#B11016] border-2 border-transparent text-white py-3 px-6 font-bold text-sm sm:text-lg hover:bg-white hover:border-[#B11016] hover:text-[#B11016] transition-colors rounded-lg",children:"UPLOAD FILES"})}),S&&(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/70 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative",children:[(0,s.jsx)("button",{onClick:()=>_(!1),className:"absolute top-4 right-5 text-gray-500 hover:text-gray-800",children:"✕"}),(0,s.jsx)("h2",{className:"text-xl font-bold text-[#B11016] mb-4",children:"Upload File"}),(0,s.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,s.jsx)("div",{className:"w-full text-red-700 text-base font-normal mb-1",children:"FILE NAME"}),(0,s.jsxs)("div",{className:"w-full relative group mb-5",children:[(0,s.jsx)("input",{type:"text",value:k,onChange:e=>I(e.target.value),placeholder:"Enter file name",className:"px-2 appearance-none w-full py-3 placeholder-gray-400 bg-transparent focus:outline-none text-sm sm:text-base","aria-label":"File Name"}),(0,s.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-[2px] bg-gray-300"}),(0,s.jsx)("div",{className:"absolute left-0 bottom-0 h-[2px] bg-red-700    transition-transform duration-300 ease-in-out    origin-center scale-x-0 w-full    group-focus-within:scale-x-100"})]}),(0,s.jsx)("div",{className:"w-full text-red-700 text-base font-normal mb-1",children:"FILE DESCRIPTION"}),(0,s.jsxs)("div",{className:"w-full relative group mb-5",children:[(0,s.jsx)("input",{type:"text",value:E,onChange:e=>P(e.target.value),placeholder:"Enter file description",className:"px-2 appearance-none w-full py-3 placeholder-gray-400 bg-transparent focus:outline-none text-sm sm:text-base","aria-label":"File Description"}),(0,s.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-[2px] bg-gray-300"}),(0,s.jsx)("div",{className:"absolute left-0 bottom-0 h-[2px] bg-red-700    transition-transform duration-300 ease-in-out    origin-center scale-x-0 w-full    group-focus-within:scale-x-100"})]}),(0,s.jsxs)("div",{onDrop:e=>{e.preventDefault(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&D(e.dataTransfer.files[0])},onDragOver:e=>e.preventDefault(),className:"border-2 border-dashed border-red-300 rounded-lg p-6 text-center cursor-pointer hover:border-red-500 transition",onClick:()=>{var e;return null==(e=F.current)?void 0:e.click()},children:[(0,s.jsx)("img",{src:"/images/uploadicon.png",alt:"Upload Icon",className:"mx-auto h-12 w-12 object-contain"}),(0,s.jsxs)("p",{className:"mt-2 text-gray-600 text-md",children:["Drag & drop files or"," ",(0,s.jsx)("span",{className:"text-red-600 underline",children:"Browse"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Supported formats: JPEG, PNG, PDF, DOCX"}),(0,s.jsx)("input",{type:"file",accept:".jpeg,.jpg,.png,.pdf,.docx",ref:F,className:"hidden",onChange:e=>{e.target.files&&e.target.files.length>0&&D(e.target.files[0])}})]}),C&&(0,s.jsxs)("div",{className:"mt-3 p-2 border border-green-400 rounded bg-green-50 text-green-700 text-xs",children:["Uploaded: ",C.name]}),(0,s.jsx)("div",{className:"w-full flex justify-end space-x-2",children:(0,s.jsx)("button",{type:"submit",className:"w-full px-4 py-2 rounded-lg bg-[#B11016] text-white font-semibold hover:bg-[#800b10]",children:"Upload"})})]})]})})]},"dashboard-page")})})})}},2766:(e,t,a)=>{Promise.resolve().then(a.bind(a,1179))},6654:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let s=a(2115);function r(e,t){let a=(0,s.useRef)(null),r=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=a.current;e&&(a.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(a.current=n(e,s)),t&&(r.current=n(t,s))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},9053:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(5155),r=a(5695),n=a(2115);function l(e){let{children:t,allowedRoles:a}=e,l=(0,r.useRouter)(),[o,i]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("role");return e&&t?a.includes(t)?void i(!1):void l.push("/"):void l.push("/login")},[l,a]),(0,s.jsx)(s.Fragment,{children:t})}}},e=>{e.O(0,[6711,8324,5751,8441,5964,7358],()=>e(e.s=2766)),_N_E=e.O()}]);