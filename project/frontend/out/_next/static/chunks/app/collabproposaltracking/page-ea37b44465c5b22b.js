(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[137],{4769:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),r=s(2115),l=s(5695);function o(e){let{children:t}=e,s="http://localhost:5000",o=(0,l.useRouter)(),[i,n]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=async()=>{let e=sessionStorage.getItem("access_token");if(!e)return void o.replace("/login");try{let t=await fetch("".concat(s,"/api/company"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){console.warn("Company fetch failed with status:",t.status),o.replace("/collabhome");return}let a=await t.json().catch(()=>null);if(!a||!a.id)return void o.replace("/collabhome");n(!1)}catch(e){console.error("Fetch error:",e.message),o.replace("/collabhome")}finally{n(!1)}};s?(console.log("API env:",s),console.log("Company URL:","".concat(s,"/api/company")),e()):console.error("NEXT_PUBLIC_API_URL is not defined")},[s,o]),(0,a.jsx)(a.Fragment,{children:t})}},7530:(e,t,s)=>{Promise.resolve().then(s.bind(s,7855))},7855:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(5155),r=s(2115),l=s(9053),o=s(4769),i=s(9911),n=s(5695),c=s(6874),d=s.n(c),x=s(760),m=s(8274);let u="http://localhost:5000",h={async getProposal(e){let t=sessionStorage.getItem("access_token");if(!t)throw Error("No access token found. Please log in again.");try{console.log("Fetching proposal from: ".concat(u,"/api/proposal/").concat(e));let s=await fetch("".concat(u,"/api/proposal/").concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!s.ok){let e=await s.text();throw Error("Failed to fetch proposal: ".concat(s.status," ").concat(s.statusText," - ").concat(e))}return await s.json()}catch(e){throw console.error("getProposal error:",e),e}},async getAllProposals(){let e=sessionStorage.getItem("access_token");if(!e)throw Error("No access token found. Please log in again.");try{let t=await fetch("".concat(u,"/api/proposal/all"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error("Failed to fetch proposals: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}let s=await t.json();return Array.isArray(s)?s:s.proposals||[]}catch(e){throw console.error("getAllProposals error:",e),e}}},p=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),b=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),f=e=>{let t=[];t.push({id:"".concat(e.id,"-submitted"),date:p(e.created_at),time:b(e.created_at),title:"Proposal Submitted",description:'Your proposal "'.concat(e.title,'" has been successfully submitted for review.'),status:"SUBMITTED",created_at:e.created_at});let s=e.status.toUpperCase();return"ONGOING"===s?t.push({id:"".concat(e.id,"-ongoing"),date:p(e.updated_at||e.created_at),time:b(e.updated_at||e.created_at),title:"Review In Progress",description:"Your proposal is currently under review by our team.",status:"ONGOING",created_at:e.updated_at||e.created_at}):"APPROVED"===s?(t.push({id:"".concat(e.id,"-ongoing"),date:p(e.updated_at||e.created_at),time:b(e.updated_at||e.created_at),title:"Review In Progress",description:"Your proposal was under review by our team.",status:"ONGOING",created_at:e.updated_at||e.created_at}),t.push({id:"".concat(e.id,"-approved"),date:p(e.updated_at),time:b(e.updated_at),title:"Proposal Approved",description:"Congratulations! Your proposal has been approved and we will proceed with the collaboration.",status:"APPROVED",created_at:e.updated_at})):"REJECTED"===s&&t.push({id:"".concat(e.id,"-rejected"),date:p(e.updated_at||e.created_at),time:b(e.updated_at||e.created_at),title:"Proposal Status Update",description:"Your proposal has been reviewed. Please check your email for detailed feedback and next steps.",status:"REJECTED",created_at:e.updated_at||e.created_at}),t};function g(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(j,{})})}function j(){let[e,t]=(0,r.useState)(null),[s,c]=(0,r.useState)(!0),[p,b]=(0,r.useState)(null),g=(0,n.useRouter)(),j=(0,n.useSearchParams)(),N=null==j?void 0:j.get("id");if((0,r.useEffect)(()=>{(async()=>{try{if(c(!0),b(null),console.log("Proposal ID from URL:",N),console.log("API Base URL:",u),N){let e=await h.getProposal(parseInt(N));console.log("Fetched proposal:",e);let s=f(e);t({...e,timeline:s})}else{let e=await h.getAllProposals();if(0===e.length)return void b("No proposals found. Please submit a proposal first.");let s=e[0],a=f(s);t({...s,timeline:a})}}catch(e){console.error("Error fetching proposal:",e),b(e instanceof Error?e.message:"Failed to fetch proposal data")}finally{c(!1)}})()},[N]),s)return(0,a.jsx)(l.A,{allowedRoles:["user"],children:(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#B11016] mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading proposal data..."})]})})})});if(p)return(0,a.jsx)(l.A,{allowedRoles:["user"],children:(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.98-.833-2.75 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error Loading Proposal"}),(0,a.jsx)("p",{className:"text-red-600 mb-4",children:p}),(0,a.jsxs)("div",{className:"space-x-4",children:[(0,a.jsx)("button",{onClick:()=>g.push("/dashboard"),className:"bg-[#B11016] text-white px-6 py-2 rounded hover:bg-[#800b10] transition-colors",children:"Back to Dashboard"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition-colors",children:"Retry"})]})]})})})});if(!e)return(0,a.jsx)(l.A,{allowedRoles:["user"],children:(0,a.jsx)(o.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Proposal Found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"The requested proposal could not be found."}),(0,a.jsx)("button",{onClick:()=>g.push("/dashboard"),className:"bg-[#B11016] text-white px-6 py-2 rounded hover:bg-[#800b10] transition-colors",children:"Back to Dashboard"})]})})})});let v=(e=>{switch(e.toUpperCase()){case"SUBMITTED":case"REJECTED":default:return 1;case"ONGOING":return 2;case"APPROVED":return 3}})(e.status),w="REJECTED"===e.status.toUpperCase();return(0,a.jsx)(l.A,{allowedRoles:["user","employee"],children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x.N,{mode:"wait",children:(0,a.jsxs)(m.P.div,{variants:{initial:{opacity:0,y:30},animate:{opacity:1,y:0,transition:{duration:.5,ease:[.25,.1,.25,1]}},exit:{opacity:0,y:-30,transition:{duration:.4,ease:[.25,.1,.25,1]}}},initial:"initial",animate:"animate",exit:"exit",className:"min-h-screen bg-white flex flex-col items-center px-[10%] py-8",children:[(0,a.jsxs)("div",{className:"relative flex items-center w-full mt-2 mb-10",children:[(0,a.jsxs)("button",{onClick:()=>g.push("/dashboard"),className:"absolute left-0 flex items-center text-[#B11016] hover:text-[#800b10] transition-colors",children:[(0,a.jsx)(i.QVr,{className:"mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Back"})]}),(0,a.jsxs)("div",{className:"text-center w-full",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-4xl font-bold text-[#B11016] pb-4",children:"Track Your Proposal"}),(0,a.jsx)("p",{className:"text-md text-black mb-6",children:"View the status of your submitted collaboration proposal with BPI."}),(0,a.jsx)("div",{className:"mx-2 border-b-[3px] border-[#B11016]"})]})]}),(0,a.jsxs)("div",{className:"relative flex items-center justify-between w-full mb-10 mt-10",children:[(0,a.jsx)("div",{className:"absolute top-5 left-10 right-1/2 h-1 z-0 mr-4 ".concat(v>=2&&!w?"bg-red-700":"bg-gray-300")}),(0,a.jsx)("div",{className:"absolute top-5 left-1/2 right-10 h-1 z-0 ml-5 ".concat(v>=3&&!w?"bg-red-700":"bg-gray-300")}),(0,a.jsxs)("div",{className:"flex flex-col items-center z-10",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full font-bold ".concat(v>=1?w?"bg-red-500 text-white":"bg-red-700 text-white":"border-2 border-gray-400 bg-white text-gray-500"),children:v>=1?"✓":"1"}),(0,a.jsx)("span",{className:"mt-2 font-bold text-xs sm:text-sm ".concat(v>=1?"text-black":"text-gray-400"),children:"SUBMITTED"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center z-10",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full font-bold ".concat(v>=2&&!w?"bg-red-700 text-white":"border-2 border-gray-400 bg-white text-gray-500"),children:"2"}),(0,a.jsx)("span",{className:"mt-2 font-bold text-xs sm:text-sm ".concat(v>=2&&!w?"text-black":"text-gray-400"),children:"IN PROGRESS"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center z-10",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full font-bold ".concat(v>=3&&!w?"bg-red-700 text-white":"border-2 border-gray-400 bg-white text-gray-500"),children:v>=3&&!w?"✓":"3"}),(0,a.jsx)("span",{className:"mt-2 font-bold text-xs sm:text-sm ".concat(v>=3&&!w?"text-black":"text-gray-400"),children:"APPROVED"})]})]}),w&&(0,a.jsx)("div",{className:"w-full mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Proposal Requires Attention"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsx)("p",{children:"Your proposal requires further review or modifications. Please check your email for detailed feedback and next steps."})})]})]})}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("label",{className:"block text-sm sm:text-base font-medium text-[#B11016] mb-4",children:"PROPOSAL TITLE"}),(0,a.jsxs)("div",{className:"relative w-full mb-6",children:[(0,a.jsx)("input",{type:"text",value:e.title,readOnly:!0,className:"w-full px-3 py-3 border-0    bg-[#E7E7E7] text-gray-900   focus:outline-none text-sm sm:text-base"}),(0,a.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-[2px] bg-[#B11016]"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm sm:text-base font-medium text-[#B11016] mb-4",children:"TYPE OF COLLABORATION"}),(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)("input",{type:"text",value:e.collab_type||"Not specified",readOnly:!0,className:"w-full px-3 py-3 border-0    bg-[#E7E7E7] text-gray-900   focus:outline-none text-sm sm:text-base"}),(0,a.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-[2px] bg-[#B11016]"})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm sm:text-base font-medium text-[#B11016] mb-4",children:"EXPECTED SUPPORT FROM BPI"}),(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)("input",{type:"text",value:e.description?e.description.length>50?e.description.substring(0,50)+"...":e.description:"See proposal description",readOnly:!0,className:"w-full px-3 py-3 border-0    bg-[#E7E7E7] text-gray-900   focus:outline-none text-sm sm:text-base",title:e.description}),(0,a.jsx)("div",{className:"absolute left-0 bottom-0 w-full h-[2px] bg-[#B11016]"})]})]})]})]}),(0,a.jsxs)("div",{className:"w-full mt-12",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-bold text-[#B11016]",children:"STATUS HISTORY"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Track the progress of your proposal submission"})]}),(0,a.jsxs)("div",{className:"relative",children:[e.timeline.length>0&&(0,a.jsx)("div",{className:"absolute left-[22px] top-0 bottom-0 w-[2px] bg-[#B11016]"}),(0,a.jsxs)("div",{className:"space-y-6",children:[e.timeline.map((e,t)=>(0,a.jsxs)("div",{className:"relative flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-11 h-11 rounded-full flex items-center justify-center z-10 ".concat("REJECTED"===e.status?"bg-red-500":"APPROVED"===e.status?"bg-green-600":"ONGOING"===e.status?"bg-yellow-600":"bg-[#B11016]"),children:(0,a.jsx)("span",{className:"text-white text-lg",children:"REJECTED"===e.status?"!":"APPROVED"===e.status?"✓":"ONGOING"===e.status?"⏳":"✓"})}),(0,a.jsxs)("div",{className:"ml-6 border border-gray-300 rounded-lg p-4 flex-1 ".concat("REJECTED"===e.status?"bg-red-50 border-red-200":"APPROVED"===e.status?"bg-green-50 border-green-200":"ONGOING"===e.status?"bg-yellow-50 border-yellow-200":"bg-gray-100"),children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:[e.date," | ",e.time]}),(0,a.jsx)("div",{className:"text-base font-semibold mb-2 ".concat("REJECTED"===e.status?"text-red-800":"APPROVED"===e.status?"text-green-800":"ONGOING"===e.status?"text-yellow-800":"text-gray-800"),children:e.title}),(0,a.jsx)("div",{className:"text-sm ".concat("REJECTED"===e.status?"text-red-700":"APPROVED"===e.status?"text-green-700":"ONGOING"===e.status?"text-yellow-700":"text-gray-700"),children:e.description})]})]},e.id)),0===e.timeline.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("p",{children:"No timeline data available"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Timeline will update as your proposal progresses"})]})]})]})]}),(0,a.jsx)("div",{className:"w-full mt-10 space-y-4",children:(0,a.jsx)(d(),{href:"/collabfiles".concat(N?"?proposalId=".concat(N):""),children:(0,a.jsx)("button",{className:"w-full bg-[#B11016] border-2 border-transparent text-white py-3 px-6 font-bold text-lg hover:bg-white hover:border-[#B11016] hover:text-[#B11016] transition-colors",children:"VIEW FILES"})})})]},"dashboard-page")})})})}},9053:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),r=s(5695),l=s(2115);function o(e){let{children:t,allowedRoles:s}=e,o=(0,r.useRouter)(),[i,n]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=sessionStorage.getItem("access_token"),t=sessionStorage.getItem("role");return e&&t?s.includes(t)?void n(!1):void o.push("/"):void o.push("/login")},[o,s]),(0,a.jsx)(a.Fragment,{children:t})}}},e=>{e.O(0,[6711,8324,6874,5433,8441,5964,7358],()=>e(e.s=7530)),_N_E=e.O()}]);