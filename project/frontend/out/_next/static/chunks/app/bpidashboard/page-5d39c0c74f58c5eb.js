(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3640],{620:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),r=s(4065),l=s(2502);function o(e){let{proposals:t}=e,s={approved:t.filter(e=>"Approved"===e.status).length,inProgress:t.filter(e=>"Ongoing"===e.status).length,submitted:t.filter(e=>"Submitted"===e.status).length,rejected:t.filter(e=>"Rejected"===e.status).length},l={labels:["Approved","In Progress","Submitted","Rejected"],datasets:[{data:[s.approved,s.inProgress,s.submitted,s.rejected],backgroundColor:["#15803d","#eab308","#1d4ed8","#b91c1c"],borderWidth:0}]},o=l.datasets[0].data.reduce((e,t)=>e+t,0);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 flex flex-col items-center h-full",children:[(0,a.jsx)("h3",{className:"text-red-700 font-bold text-xl mb-6 text-center",children:"Proposal Report"}),(0,a.jsxs)("div",{className:"flex flex-col 2xl:flex-row items-center justify-center gap-6 2xl:gap-10 w-full",children:[(0,a.jsxs)("div",{className:"relative w-36 h-36 sm:w-44 sm:h-44 2xl:w-56 2xl:h-56 flex-shrink-0",children:[(0,a.jsx)(r.nu,{data:l,options:{cutout:"65%",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0}}}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-2xl sm:text-3xl 2xl:text-4xl font-bold text-gray-900",children:o})]}),(0,a.jsx)("div",{className:"flex flex-col space-y-3 w-full 2xl:w-auto items-center 2xl:items-start",children:l.labels.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:l.datasets[0].backgroundColor[t]}}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[e," (",l.datasets[0].data[t],")"]})]},e))})]})]})}l.t1.register(l.Bs,l.m_,l.s$)},2218:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),r=s(620),l=s(9460),o=s(5695),i=s(2115),n=s(7650);function c(){var e;let t=(0,o.useRouter)(),s="http://localhost:5000",[c,d]=(0,i.useState)([]),[p,m]=(0,i.useState)({}),[g,h]=(0,i.useState)(!0),[x,u]=(0,i.useState)(null),[b,f]=(0,i.useState)(null),[j,v]=(0,i.useState)({top:0,left:0}),y=e=>{switch(e){case"SUBMITTED":return"Submitted";case"ONGOING":return"In Progress";case"APPROVED":return"Approved";case"REJECTED":return"Rejected";default:return e}},N=async e=>{let t=sessionStorage.getItem("access_token");try{let a=await fetch("".concat(s,"/api/company/").concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!a.ok)return console.warn("Failed to fetch company ".concat(e)),null;return(await a.json()).company}catch(t){return console.error("Error fetching company ".concat(e,":"),t),null}};(0,i.useEffect)(()=>{(async()=>{let e=sessionStorage.getItem("access_token");try{console.log("Fetching proposals from:","".concat(s,"/api/proposal"));let t=await fetch("".concat(s,"/api/proposal"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch proposals");let a=await t.json();console.log("Full API Response:",a);let r=a.proposals||a||[];console.log("Extracted proposals list:",r),d(Array.isArray(r)?r:[]);let l=[...new Set(r.map(e=>e.company_id).filter(e=>null!=e))];console.log("Unique company IDs:",l);let o=l.map(async e=>{let t=await N(e);return{id:e,company:t}}),i=await Promise.all(o),n={};i.forEach(e=>{let{id:t,company:s}=e;s&&(n[t]=s)}),console.log("Companies lookup:",n),m(n)}catch(e){console.error("Error fetching proposals:",e),d([])}finally{h(!1)}})()},[s]),(0,i.useEffect)(()=>{let e=()=>{f(null)};if(null!==b)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[b]);let w=e=>e.company_id&&p[e.company_id]?p[e.company_id].name:e.company_name||"Unknown Company",_=[{label:"Submitted",count:c.filter(e=>"Submitted"===y(e.status)).length,img:"/images/db_submitted.png"},{label:"In Progress",count:c.filter(e=>"In Progress"===y(e.status)).length,img:"/images/db_inprogress.png"},{label:"Approved",count:c.filter(e=>"Approved"===y(e.status)).length,img:"/images/db_approved.png"},{label:"Rejected",count:c.filter(e=>"Rejected"===y(e.status)).length,img:"/images/db_rejected.png"}],S=c.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,3),k=async(e,t)=>{let a=sessionStorage.getItem("access_token");u(e);try{let r=await fetch("".concat(s,"/api/proposal/").concat(e,"/status"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({status:(e=>{switch(e){case"Submitted":return"SUBMITTED";case"In Progress":return"ONGOING";case"Approved":return"APPROVED";case"Rejected":return"REJECTED";default:return e}})(t)})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update proposal status")}let l=await r.json();d(t=>t.map(t=>t.id===e?{...t,status:l.proposal.status}:t)),alert("Proposal status updated to: ".concat(t)),f(null)}catch(e){console.error("Error updating proposal status:",e),alert("Error updating proposal status: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{u(null)}};return(0,a.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,a.jsx)(l.A,{}),(0,a.jsxs)("main",{className:"flex-1 py-3 sm:py-6 pl-[2%] sm:pl-[3%] pr-[3%] sm:pr-[5%]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b-[3px] border-red-700 pb-2 sm:pb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-red-700",children:"Employee Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage collaboration proposals from all companies."})]}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-[#B11016] border-2 text-white px-4 py-2 rounded-md hover:bg-white hover:border-[#B11016] hover:text-[#B11016] transition",children:"Refresh"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-[69%_30%] gap-4 mt-5",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 m-0 p-0",children:_.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg flex items-center gap-4 drop-shadow-lg border border-gray-500",children:[(0,a.jsx)("img",{src:e.img,alt:e.label,className:"m-0 p-0 h-full w-auto object-cover"}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,a.jsx)("h2",{className:"text-4xl font-bold",children:e.count})})]},t))}),(0,a.jsxs)("div",{className:"bg-white rounded-lg drop-shadow-lg sm:p-8 p-6 border border-gray-500 h-[350px] flex flex-col",children:[(0,a.jsx)("h3",{className:"text-red-700 font-bold text-xl mb-4 border-b border-black pb-2 sm:pb-4",children:"Recent Activities"}),(0,a.jsx)("div",{className:"relative flex-1 overflow-y-auto pr-2",style:{"--dot-size":"0.75rem"},children:0===S.length?(0,a.jsx)("p",{className:"text-gray-500 text-center mt-6",children:"No recent activities"}):(0,a.jsx)("div",{className:"space-y-0",children:S.map((e,t,s)=>(0,a.jsxs)("div",{className:"relative flex items-start",children:[(0,a.jsx)("div",{className:"relative z-10 rounded-full flex-shrink-0 bg-[#B11016]",style:{width:"var(--dot-size)",height:"var(--dot-size)",marginTop:"0.5rem"}}),t<s.length-1&&(0,a.jsx)("div",{className:"absolute left-[calc(var(--dot-size)/2-1px)] top-[calc(var(--dot-size)+0.5rem)] w-0.5 bg-gray-300",style:{height:"calc(100% - var(--dot-size) - 0rem)"}}),(0,a.jsxs)("div",{className:"ml-4 pb-2",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:e.title}),(0,a.jsx)("div",{className:"text-sm text-blue-600 mb-1",children:w(e)}),(0,a.jsx)("div",{className:"font-bold text-gray-800 mb-1",children:y(e.status)}),(0,a.jsxs)("div",{className:"text-gray-500 text-xs",children:[new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})," ","|"," ",new Date(e.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]})]},t))})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-[69%_30%] gap-4 mt-5 items-stretch",children:[(0,a.jsxs)("div",{className:"sm:col-span-1 border border-gray-500 rounded-lg p-5 bg-white drop-shadow-xl relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-red-700 font-bold text-lg",children:"Your Proposals"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Click on any row to view details"})]}),(0,a.jsx)("div",{className:"max-h-200 overflow-y-auto relative",children:(0,a.jsxs)("table",{className:"w-full text-sm rounded-lg overflow-hidden",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 text-left text-red-700",children:"ID"}),(0,a.jsx)("th",{className:"p-3 text-left text-red-700",children:"Company"}),(0,a.jsx)("th",{className:"p-3 text-left text-red-700",children:"Proposal Title"}),(0,a.jsx)("th",{className:"p-3 text-left text-red-700",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-center text-red-700",children:"Action"})]})}),(0,a.jsxs)("tbody",{children:[!g&&0===c.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"p-3 text-center text-gray-500",children:"No proposals found"})}),!g&&c.map((e,s)=>(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>(e=>{console.log("=== NAVIGATION DEBUG ==="),console.log("Proposal ID:",e);let s=sessionStorage.getItem("access_token"),a=sessionStorage.getItem("role");if(!s){alert("Session expired. Please log in again."),t.push("/login");return}if(!a){alert("Role information missing. Please log in again."),t.push("/login");return}if("employee"!==a)return void alert("Access denied. Employee role required.");let r="/bpiproposaltracking?id=".concat(e);console.log("Navigating to:",r),t.push(r)})(e.id),children:[(0,a.jsx)("td",{className:"p-3",children:e.id}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("div",{className:"font-medium",children:w(e)})}),(0,a.jsxs)("td",{className:"p-3",children:[(0,a.jsx)("div",{className:"font-medium",children:e.title||"No title"}),e.description&&(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:e.description.length>50?"".concat(e.description.substring(0,50),"..."):e.description})]}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Approved"===y(e.status)?"bg-green-100 text-green-800":"Rejected"===y(e.status)?"bg-red-100 text-red-800":"In Progress"===y(e.status)?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:y(e.status)})}),(0,a.jsx)("td",{className:"p-3 text-center",children:(0,a.jsx)("button",{onClick:e=>((e,t)=>{if(e.stopPropagation(),b===t)return void f(null);let s=e.currentTarget.getBoundingClientRect(),a=window.scrollY,r=window.scrollX;v({top:s.bottom+a+5,left:s.right+r-160}),f(t)})(e,s),className:"text-xl font-bold text-gray-600 hover:text-red-600 disabled:opacity-50",disabled:x===e.id,children:x===e.id?"...":"⋮"})})]},e.id))]})]})}),g&&(0,a.jsx)("p",{className:"text-center p-3",children:"Loading proposals..."})]}),(0,a.jsx)("div",{className:"sm:col-span-1 h-full border border-gray-500 rounded-lg drop-shadow-lg",children:(0,a.jsx)(r.A,{proposals:c})})]}),null!==b&&(0,n.createPortal)((0,a.jsx)("div",{className:"absolute w-40 bg-white border rounded-lg shadow-lg z-50",style:{top:"".concat(j.top,"px"),left:"".concat(j.left,"px")},onClick:e=>e.stopPropagation(),children:(e=>{let t=y(e);return["Submitted","In Progress","Approved","Rejected"].filter(e=>e!==t)})((null==(e=c[b])?void 0:e.status)||"").map(e=>{var t;return(0,a.jsxs)("button",{onClick:t=>{t.stopPropagation(),k(c[b].id,e)},className:"w-full px-4 py-2 text-left text-sm hover:bg-red-100 text-red-700 border-b border-gray-100 last:border-b-0 first:rounded-t-lg last:rounded-b-lg",disabled:x===(null==(t=c[b])?void 0:t.id),children:["Set to ",e]},e)})}),document.body)]})]})}},9159:(e,t,s)=>{Promise.resolve().then(s.bind(s,2218))},9460:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(5155),r=s(2115),l=s(5695),o=s(8274);function i(){let e=(0,l.usePathname)(),[t,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{s(sessionStorage.getItem("role"))},[]),(0,a.jsxs)(o.P.aside,{initial:{x:-250,opacity:0},animate:{x:0,opacity:1},exit:{x:-250,opacity:0},transition:{duration:.2,ease:[.25,.1,.25,1]},className:"pl-4 group relative bg-white border-r flex flex-col items-center items-start py-4 space-y-6 h-screen w-20 hover:w-56 transition-all duration-300 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 pl-1",children:[(0,a.jsx)("img",{src:"/logo/synsei_icon.png",alt:"Logo",className:"w-10"}),(0,a.jsx)("span",{className:"text-lg font-bold text-gray-800 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"Synsei"})]}),(0,a.jsx)("nav",{className:"flex flex-col space-y-2 w-[92%]",children:("user"===t?[{href:"/dashboard",icon:"/images/Sidebar_home.png",label:"Home"},{href:"/collabapproved",icon:"/images/Folder_check.png",label:"Approved"},{href:"/collabinprocess",icon:"/images/folder-send.png",label:"In Process"},{href:"/collabrejected",icon:"/images/Folder_del.png",label:"Rejected"}]:"employee"===t?[{href:"/bpidashboard",icon:"/images/Sidebar_home.png",label:"Home"},{href:"/bpiapproved",icon:"/images/Folder_check.png",label:"Approved"},{href:"/bpiinprocess",icon:"/images/folder-send.png",label:"In Process"},{href:"/bpirejected",icon:"/images/Folder_del.png",label:"Rejected"},{href:"/bpifilesviewer",icon:"/images/Folder_del.png",label:"FileViewer"},{href:"/companylist",icon:"/images/building-03.png",label:"Collaborators"},{href:"/bpifindcollab",icon:"/images/peer-to-peer-02.png",label:"Find Collaborators"}]:"admin"===t?[{href:"/admindashboard",icon:"/images/Sidebar_home.png",label:"Home"},{href:"/bpiapproved",icon:"/images/Folder_check.png",label:"Approved"},{href:"/bpiinprocess",icon:"/images/folder-send.png",label:"In Process"},{href:"/bpirejected",icon:"/images/Folder_del.png",label:"Rejected"},{href:"/adminfilesviewer",icon:"/images/Folder_del.png",label:"FileViewer"},{href:"/companylist",icon:"/images/building-03.png",label:"Collaborators"},{href:"/bpifindcollab",icon:"/images/peer-to-peer-02.png",label:"Find Collaborators"}]:[]).map((t,s)=>(0,a.jsxs)("a",{href:t.href,className:"flex items-center gap-3 rounded-lg transition-all duration-200\n              ".concat(e===t.href?"bg-[#FEC2C5]":"hover:bg-gray-100","\n              px-2 py-2 w-12 group-hover:w-full"),children:[(0,a.jsx)("img",{src:t.icon,alt:t.label,className:"w-8 h-8"}),(0,a.jsx)("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap",children:t.label})]},s))})]})}}},e=>{e.O(0,[5647,8324,8579,8441,5964,7358],()=>e(e.s=9159)),_N_E=e.O()}]);